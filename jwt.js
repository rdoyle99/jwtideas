app.post('/create-checkout-session/mth', async (req, res) => { user = req.user._id; const session = await stripe.checkout.sessions.create({ payment_method_types: ['card'], line_items: [{ price: process.env.MONTHLY_COST, quantity: 1 }], mode: 'subscription', success_url: `https://${process.env.BASE_URL}/stripesuccess?{CHECKOUT_SESSION_ID}`, cancel_url: `https://${process.env.BASE_URL}/dash`, let token = req.body.token; if (!token) { console.log('no token'); //return res.status(403).send({ message: 'No token provided!' }); } jwt.verify(token, process.env.JWT_SECRET, async (err, decoded) => { if (err) { console.log('jwt stripe err in app.js', err); //return res.status(401).send({ message: 'Unauthorized!' }); } const user = decoded.id; console.log(user); try { const session = await stripe.checkout.sessions.create({ payment_method_types: ['card'], line_items: [{ price: process.env.MONTHLY_COST, quantity: 1 }], subscription_data: { trial_period_days: 7, }, mode: 'subscription', success_url: `https://${process.env.BASE_URL}/stripesuccess?{CHECKOUT_SESSION_ID}`, cancel_url: `https://${process.env.BASE_URL}/dash`, }); res.json({ sessionId: session.id }); } catch (e) { console.log(e); }
